local locations = 
{
    rulebookLoc = {-54.06, 0.97, -50.58},
    rulebookRot = {0.00, 180.0, 0.00},

    rulebookAids = 
    {
        {-60.28, 0.97, 23.94},
        {-54.59, 0.97, 23.97},
        {-48.94, 0.97, 24.06},
        {-43.15, 0.97, 24.02},
        {-37.46, 0.97, 24.02},
        {-60.26, 0.97, 15.76},
        {-54.62, 0.97, 15.84},
        {-48.98, 0.97, 15.84},
        {-43.27, 0.97, 15.85},
        {-37.56, 0.97, 15.82}
    },
    rulebookAidRot = {0.00, 180.03, 0.00},

    oxygenTokenLoc = {{-22.25, 1.04, -21.33},{-6.02, 1.04, -21.42},{10.40, 1.04, -21.34},{24.88, 1.04, -21.61}},
    oxygenTokenRot = {0.00, 180.0, 0.0},
    oxygenCubesBagLoc = {11.55, 0.97, 6.87},
    oxygenCubesBagRot = {0.00, 0.00, 0.00},

    oxygenCubeLocs = {{-22.23, 1.28, -21.01},{-22.24, 1.28, -21.40},{-22.23, 1.28, -21.77},{-22.24, 1.28, -22.17},
                    {-6.00, 1.28, -21.10},{-6.01, 1.28, -21.48},{-6.01, 1.28, -21.86},{-6.01, 1.28, -22.26},
                    {10.43, 1.28, -21.02},{10.41, 1.28, -21.41},{10.42, 1.28, -21.78},{10.41, 1.28, -22.18},
                    {24.90, 1.28, -21.29},{24.89, 1.28, -21.68},{24.90, 1.28, -22.05},{24.89, 1.28, -22.45}},

    upgradeBoardGunnerLoc = {-24.20, 1.12, -17.71},
    upgradeBoardScoutLoc = {-8.76, 1.07, -17.69},
    upgradeBoardDrillerLoc = {6.60, 1.07, -17.69},
    upgradeBoardEngineerLoc = {21.98, 1.11, -17.70},
    upgradeBoardRot = {0.0, 90.0, 0.0},

    spaceRigBoardLoc = {-43.44, 1.07, 1.15},
    spaceRigBoardRot = {0.00, 180.0, 0.00},

    trackerCube1Loc = {-48.17, 1.41, -2.41},
    trackerCube1Rot = {0.00, 0.0, 180.00},
    trackerCube2Loc = {-42.81, 1.51, 0.53},
    trackerCube2Rot = {0.00, 0.0, 180.00},

    memorialStatueLoc = {-46.87, 1.16, 0.89},
    memorialStatueRot = {0.00, 209.98, 0.00},

    challengeDeckLoc = {-46.00, 2.0, 3.84},
    challengeDeckRot = {0.00, 180.00, 180.00},

    beerDeckLoc = {-38.03, 2.0, 3.50},
    beerDeckRot = {0.00, 180.0, 180.00}, 

    stickerLocs =
    {
        {-54.99, 1.04, 4.01}, -- stickerExterminators
        {-53.89, 1.05, 4.01}, -- stickerSuperProtector
        {-52.79, 1.04, 4.01}, -- stickerUpClose
        {-51.69, 1.04, 4.01}, -- stickerBreathtaking
        {-55.54, 1.05, 3.06}, -- stickerHardboiled
        {-54.44, 1.05, 3.06}, -- stickerHoarders
        {-53.34, 1.05, 3.06}, -- stickerRoughnecks
        {-52.24, 1.04, 3.06} -- stickerVeteranDwarves
    },
    stickerRot = {0.0, 180.0, 0.0}, 

    missionModRedLoc = {-34.65, 0.97, 1.15},
    missionModRedRot = {0.0,0.0,0.0},
    missionModYellowLoc = {-34.65, 0.97, -0.75},
    missionModYellowRot = {0.00, 180.00, 0.00},

    upgradesHUDBagLoc = {-54.44, 0.97, 1.15},
    upgradesArmourBagLoc = {-53.34, 0.97, 1.15},
    upgradesPickaxeBagLoc = {-52.24, 0.97, 1.15},
    upgradesRot = {0.00, 180.00, 0.00},

    pickupShuffleBagLoc = {12.10, 0.97, -7.42},
    pickupAbandonedGearBagLoc = {13.20, 0.97, -7.42},
    pickupGoldBugBagLoc = {14.30, 0.97, -7.42},
    pickupMaltSaltBagLoc = {15.40, 0.97, -7.42},
    pickupYeastBagLoc = {16.50, 0.97, -7.42},
    pickupRot = {0.0,0.0,0.0},

    pumpjackBagLoc = {-14.85, 0.96, 3.06},
    pumpjackBagRot = {0.00, 180.00, 0.00},
    pipeStraightBagLoc = {-14.85, 0.97, 1.15},
    pipeStraightBagRot = {0.0,0.0,0.0},
    pipeCurvedBagLoc = {-14.85, 0.97, -0.75},
    pipeCurvedBagRot = {0.00, 240.00, 0.00},

    drilldozerLoc = {-24.75, 0.97, 1.15},
    drilldozerRot = {0.00, 270.0, 0.00},
    drilldozerTokenLoc = {-22.00, 1.05, -1.70},
    drilldozerTokenRot = {0.00, 180.0, 0.00},

    refineryLoc = {-15.95, 1.11, -2.66},
    refineryRot = {0.00, 300.00, 180.00},

    beamerBagLoc = {-19.25, 0.96, 1.15},
    beamerBagRot = {0.00, 90.00, 0.00},

    hearthstoneLoc = {-21.45, 0.97, 1.15},
    hearthstoneRot = {0.00, 239.96, 0.00},
    hearthstoneGemLoc = {-21.41, 1.37, 1.28},
    hearthstoneGemRot = {50.92, 83.33, 192.57},

    miniHiddenCavesBagLoc = {16.50, 0.95, 0.20},
    miniHiddenCavesBagRot = {0.00, 60.00, 0.00},

    redCubeLocs =
    {
        {-22.20, 1.29, -1.37},
        {-21.67, 1.29, -1.36},
        {-21.14, 1.29, -1.36},
        {-20.62, 1.29, -1.36},
        {-20.09, 1.29, -1.36}
    }
}

local stickerNames = 
{
    'Exterminators',
    'Super Protectors',
    'Up Close',
    'Breathtaking',
    'Hardboiled',
    'Hoarders',
    'Roughnecks',
    'Veteran Dwarves'
}

local GUIDs =
{
    expansionBox = '248e97',

    rulebook = '768854',

    rulebookAids = {'c931f7', '249ea6', 'b49b2f', '19b926', '2d0564', '596fb7', '2f31fd',
        '945a76', '17cd74', 'd4ff36'},

    oxygenTokens = {'9ba832','fca59c','d1b82b','32fdff'},
    oxygenCubesBag = 'd0b7aa',

    upgradeBoardGunner = '8a4b95',
    upgradeBoardScout = '89eadd',
    upgradeBoardDriller = '1f888c',
    upgradeBoardEngineer = 'fd11cf',

    spaceRigBoard = '6f0b82',
    memorialStatue = '52fc48',
    trackerCube1 = '290dc9',
    trackerCube2 = '833ce7',

    stickers =
    {
        'b1d92f', -- stickerExterminators
        '1e1671', -- stickerSuperProtector
        'e9b53e', -- stickerUpClose
        '4db170', -- stickerBreathtaking
        'c6226c', -- stickerHardboiled
        '3398c9', -- stickerHoarders
        'f3c70c', -- stickerRoughnecks
        '7ed6db' -- stickerVeteranDwarves
    },

    missionModRedBag = '5ed9dd',
    missionModYellowBag = 'b1377f',

    upgradesHUDBag = 'f1904b',
    upgradesArmourBag = '30b4e1',
    upgradesPickaxeBag = '074163',

    pickupShuffleBag = '1f2255',
    pickupAbandonedGearBag = '9455c7',
    pickupGoldBugBag = '3ebf97',
    pickupMaltSaltBag = '6ff8d3',
    pickupYeastBag = 'e22bb0',

    pumpjackBag = '845be5',
    pipeStraightBag = '8d3753',
    pipeCurvedBag = 'a52a6d',

    drilldozer = '8887ac',
    drilldozerToken = 'cdd78c',

    refinery = '1d5b9a',

    beamerBag = '3d4ec3',
    heartstoneClosed = '64c2ff',
    hearstoneOpen = 'd84756',
    hearstoneGem = 'c0ab17',

    miniHiddenCaveBag = '3cff09',

    cards = 
    {
        secondaries =
        {
            '92a6b2', -- scopedSubata
            '8251b1', -- stubbyExplosive
        },

        rockAndStone = 
        {
            'ffb477', -- betterEquipment
            '41302c', -- bottomsUp
        }
    }
}

function onLoad()
    self.clearButtons()

    if Global.call('getSpaceRigExpansionToggle') then
        ShowDisableExpansionButton()
    else
        ShowEnableExpansionButton()
    end

    expansionBox = getObjectFromGUID(GUIDs.expansionBox)
end

function ShowEnableExpansionButton()
    self.clearButtons()

    self.createButton(
        {
            click_function='ConfirmSetupButton',
            function_owner=self,
            label="Enable\n Expansion",
            position={0.0,1.0,-5.0},
            rotation={0.0,0.0, 0.0},
            width=1100*1.5,
            height=360*1.5,
            font_size=150*1.5,
            font_color='White',
            color='Green',
            tooltip='Enable Space Rig Expansion'
        }
    )
end

function ShowDisableExpansionButton()
    self.clearButtons()

    self.createButton(
        {
            click_function='ConfirmCleanupButton',
            function_owner=self,
            label="Disable\n Expansion",
            position={0.0,1.0,-5.0},
            rotation={0.0,0.0, 0.0},
            width=1100*1.5,
            height=360*1.5,
            font_size=150*1.5,
            font_color='White',
            color='Red',
            tooltip='Disable Space Rig Expansion'
        }
    )
end

function ConfirmSetupButton()
    self.createButton(
        {
            click_function='EnableExpansion',
            function_owner=self,
            label="Yes",
            position={-1.0,1.0,-3.7},
            rotation={0.0,0.0, 0.0},
            width=500*1.5,
            height=350*1.5,
            font_size=150*1.5,
            font_color='White',
            color='Green',
            tooltip='Yes - Continue Setup'
        }
    )

    self.createButton(
        {
            click_function='ShowEnableExpansionButton',
            function_owner=self,
            label="No",
            position={1.0,1.0,-3.7},
            rotation={0.0,0.0, 0.0},
            width=500*1.5,
            height=350*1.5,
            font_size=150*1.5,
            font_color='White',
            color='Red',
            tooltip='No - Cancel Setup'
        }
    )
end

function ConfirmCleanupButton()
    self.createButton(
        {
            click_function='DisableExpansion',
            function_owner=self,
            label="Yes",
            position={-1.0,1.0,-3.7},
            rotation={0.0,0.0, 0.0},
            width=500*1.5,
            height=350*1.5,
            font_size=150*1.5,
            font_color='White',
            color='Green',
            tooltip='Yes - Continue Cleanup'
        }
    )

    self.createButton(
        {
            click_function='ShowDisableExpansionButton',
            function_owner=self,
            label="No",
            position={1.0,1.0,-3.7},
            rotation={0.0,0.0, 0.0},
            width=500*1.5,
            height=350*1.5,
            font_size=150*1.5,
            font_color='White',
            color='Red',
            tooltip='No - Cancel Cleanup'
        }
    )
end

function EnableExpansion()
    self.clearButtons()

    Wait.time(function()
        ShowDisableExpansionButton()
    end,2)

    -- Checks if there are players minis in the cleanup zone (on a mission)
    if (Global.Call('getMissionCleanupScript').Call('CheckForPlayersInCleanupZone')) then
        printToAll('Unable to set up: Space Rig Expansion', 'Red')
        printToAll('Mission in progress detected, cleanup mission before enabling expansion\n', 'Red')
        return
    end

    printToAll('Setting up: Space Rig Expansion', 'Yellow')

    Global.Call('setSpaceRigExpansionToggle',true)

    -- Rulebook setup
    params={
        bag = expansionBox,
        ID = GUIDs.rulebook,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.rulebookLoc,
            rotation = locations.rulebookRot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Space Rig Rulebook, it's not in the expansion box", 'Red')
    end

    -- Rulebook aids
    -- Ideally I wanted to do #GUIDs.rulebookAids but it was not working - gives 0 count
    for i = 1, 10 do
        params={
            bag = expansionBox,
            ID = GUIDs.rulebookAids[i],
        }
        if Global.call('isInBag',params) then
            params.bag.takeObject({
                position = locations.rulebookAids[i],
                rotation = locations.rulebookAidRot,
                guid = params.ID,
                callback="afterSpawnLock", callback_owner=Global
            })
        else
            printToAll("Warning: Unable to set up Space Rig Rulebook Aids, it's not in the expansion box", 'Red')
        end
    end

    -- Oxygen token setup
    for i = 1, 4 do
        params={
            bag = expansionBox,
            ID = GUIDs.oxygenTokens[i],
        }
        if Global.call('isInBag',params) then
            params.bag.takeObject({
                position = locations.oxygenTokenLoc[i],
                rotation = locations.oxygenTokenRot,
                guid = params.ID,
                callback="afterSpawnLock", callback_owner=Global
            })
        else
            printToAll("Warning: Unable to set up Oxygen Tokens, it's not in the expansion box", 'Red')
        end
    end

    -- Oxygen Cubes Bag
    params={
        bag = expansionBox,
        ID = GUIDs.oxygenCubesBag,
    }
    if Global.call('isInBag',params) then
        oxygenBag = params.bag.takeObject({
            position = locations.oxygenCubesBagLoc,
            rotation = locations.oxygenCubesBagRot,
            guid = params.ID,
            callback="afterSpawnLock", callback_owner=Global
        })

        for i = 1, 16 do
            oxygenBag.takeObject({
                position = locations.oxygenCubeLocs[i]
            })
        end
    else
        printToAll("Warning: Unable to set up Oxygen Cube Bag, it's not in the expansion box", 'Red')
    end

    -- Upgrade Boards - Gunner
        params={
        bag = expansionBox,
        ID = GUIDs.upgradeBoardGunner,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.upgradeBoardGunnerLoc,
            rotation = locations.upgradeBoardRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Gunner Upgrade Board, it's not in the expansion box", 'Red')
    end

    -- Upgrade Boards - Scout
    params={
        bag = expansionBox,
        ID = GUIDs.upgradeBoardScout,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.upgradeBoardScoutLoc,
            rotation = locations.upgradeBoardRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Scout Upgrade Board, it's not in the expansion box", 'Red')
    end

    -- Upgrade Boards - Driller
    params={
        bag = expansionBox,
        ID = GUIDs.upgradeBoardDriller,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.upgradeBoardDrillerLoc,
            rotation = locations.upgradeBoardRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Driller Upgrade Board, it's not in the expansion box", 'Red')
    end

    -- Upgrade Boards - Engineer
    params={
        bag = expansionBox,
        ID = GUIDs.upgradeBoardEngineer,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.upgradeBoardEngineerLoc,
            rotation = locations.upgradeBoardRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Engineer Upgrade Board, it's not in the expansion box", 'Red')
    end

    -- Space Rig Board
    params={
        bag = expansionBox,
        ID = GUIDs.spaceRigBoard,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.spaceRigBoardLoc,
            rotation = locations.spaceRigBoardRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Space Rig Board, it's not in the expansion box", 'Red')
    end

    -- Tracker cube 1 -- bigger cube
    params={
        bag = expansionBox,
        ID = GUIDs.trackerCube1,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.trackerCube1Loc,
            rotation = locations.trackerCube1Rot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Space Rig Board mission number cube, it's not in the expansion box", 'Red')
    end

    -- Tracker cube 2 -- smaller cube
    params={
        bag = expansionBox,
        ID = GUIDs.trackerCube2,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.trackerCube2Loc,
            rotation = locations.trackerCube2Rot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Space Rig Board Progression cube, it's not in the expansion box", 'Red')
    end

    -- Memorial statue
    params={
        bag = expansionBox,
        ID = GUIDs.memorialStatue,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.memorialStatueLoc,
            rotation = locations.memorialStatueRot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Memorial Statue, it's not in the expansion box", 'Red')
    end

    -- Secondary card: subata
    params={
        bag = expansionBox,
        ID = GUIDs.cards.secondaries[1],
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = Global.call('getSecondariesDeckZone').GetPosition(),
            rotation = {0.00, 180.00, 0.00},
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Secondaries Card: Scoped Subata, it's not in the expansion box", 'Red')
    end

    -- Secondary card: stubby
    params={
        bag = expansionBox,
        ID = GUIDs.cards.secondaries[2],
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = Global.call('getSecondariesDeckZone').GetPosition(),
            rotation = {0.00, 180.00, 0.00},
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Secondaries Card: Explosive Stubby, it's not in the expansion box", 'Red')
    end

    -- R&S card: better equipment
    params={
        bag = expansionBox,
        ID = GUIDs.cards.rockAndStone[1],
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = Global.call('getRockAndStoneDeckZone').GetPosition(),
            rotation = {0.0, 90.0, 180.0},
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Secondaries Card: Scoped Subata, it's not in the expansion box", 'Red')
    end

    -- R&S card: bottom's up
    params={
        bag = expansionBox,
        ID = GUIDs.cards.rockAndStone[2],
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = Global.call('getRockAndStoneDeckZone').GetPosition(),
            rotation = {0.0, 90.0, 180.0},
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Secondaries Card: Explosive Stubby, it's not in the expansion box", 'Red')
    end

    -- Mission modifiers: Anomalies Box (Yellow)
    params={
        bag = expansionBox,
        ID = GUIDs.missionModYellowBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.missionModYellowLoc,
            rotation = locations.missionModYellowRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Mission Modifier Anomalies bag, it's not in the expansion box", 'Red')
    end

    -- Mission Modifiers: Warnings Box (Red)
    params={
        bag = expansionBox,
        ID = GUIDs.missionModRedBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.missionModRedLoc,
            rotation = locations.missionModRedRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Mission Modifiers Warnings bag, it's not in the expansion box", 'Red')
    end

    -- Upgrades: Hud Bag
    params={
        bag = expansionBox,
        ID = GUIDs.upgradesHUDBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.upgradesHUDBagLoc,
            rotation = locations.upgradesRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Mission Modifiers Warnings bag, it's not in the expansion box", 'Red')
    end

    -- Upgrades: Armour bag
    params={
        bag = expansionBox,
        ID = GUIDs.upgradesArmourBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.upgradesArmourBagLoc,
            rotation = locations.upgradesRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Mission Modifiers Warnings bag, it's not in the expansion box", 'Red')
    end

    -- Upgrades: Pickaxe Bag
    params={
        bag = expansionBox,
        ID = GUIDs.upgradesPickaxeBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.upgradesPickaxeBagLoc,
            rotation = locations.upgradesRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Mission Modifiers Warnings bag, it's not in the expansion box", 'Red')
    end

    -- Pickups: Shuffle Bag
    params={
        bag = expansionBox,
        ID = GUIDs.pickupShuffleBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pickupShuffleBagLoc,
            rotation = locations.pickupRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Pickups shuffle bag, it's not in the expansion box", 'Red')
    end

    -- Pickups: Abandoned Gear Bag
    params={
        bag = expansionBox,
        ID = GUIDs.pickupAbandonedGearBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pickupAbandonedGearBagLoc,
            rotation = locations.pickupRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Abandoned Gear bag, it's not in the expansion box", 'Red')
    end

    -- Pickups: Gold Loot Bug Bag
    params={
        bag = expansionBox,
        ID = GUIDs.pickupGoldBugBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pickupGoldBugBagLoc,
            rotation = locations.pickupRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Gold loot bug bag, it's not in the expansion box", 'Red')
    end

    -- Pickups: Malt Salt Bag
    params={
        bag = expansionBox,
        ID = GUIDs.pickupMaltSaltBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pickupMaltSaltBagLoc,
            rotation = locations.pickupRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Malt Salt bag, it's not in the expansion box", 'Red')
    end

    -- Pickups: Yeast bulb Bag
    params={
        bag = expansionBox,
        ID = GUIDs.pickupYeastBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pickupYeastBagLoc,
            rotation = locations.pickupRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Yeast Cone bag, it's not in the expansion box", 'Red')
    end

    -- Pump Jack Bag
    params={
        bag = expansionBox,
        ID = GUIDs.pumpjackBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pumpjackBagLoc,
            rotation = locations.pumpjackBagRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Pumpjack bag, it's not in the expansion box", 'Red')
    end

    -- Straight pipe bag
    params={
        bag = expansionBox,
        ID = GUIDs.pipeStraightBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pipeStraightBagLoc,
            rotation = locations.pipeStraightBagRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Straight pipe bag, it's not in the expansion box", 'Red')
    end

    -- Curved pipe bag
    params={
        bag = expansionBox,
        ID = GUIDs.pipeCurvedBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.pipeCurvedBagLoc,
            rotation = locations.pipeCurvedBagRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Curved pipe bag, it's not in the expansion box", 'Red')
    end

    -- Drilldozer
    params={
        bag = expansionBox,
        ID = GUIDs.drilldozer,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.drilldozerLoc,
            rotation = locations.drilldozerRot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Drilldozer mini, it's not in the expansion box", 'Red')
    end

    -- Drilldozer Token
    params={
        bag = expansionBox,
        ID = GUIDs.drilldozerToken,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.drilldozerTokenLoc,
            rotation = locations.drilldozerTokenRot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Drilldozer token, it's not in the expansion box", 'Red')
    end

    -- Refinery
    params={
        bag = expansionBox,
        ID = GUIDs.refinery,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.refineryLoc,
            rotation = locations.refineryRot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Oil Refinery, it's not in the expansion box", 'Red')
    end

    -- Beamers Bag
    params={
        bag = expansionBox,
        ID = GUIDs.beamerBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.beamerBagLoc,
            rotation = locations.beamerBagRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Ommoran Beamer Bag, it's not in the expansion box", 'Red')
    end

    -- Hearstone
    params={
        bag = expansionBox,
        ID = GUIDs.heartstoneClosed,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.hearthstoneLoc,
            rotation = locations.hearthstoneRot,
            guid = params.ID
        })
    else -- if closed hearstone mini no found, find the open version
        params={
            bag = expansionBox,
            ID = GUIDs.hearstoneOpen,
        }
        if Global.call('isInBag',params) then
            params.bag.takeObject({
                position = locations.hearthstoneLoc,
                rotation = locations.hearthstoneRot,
                guid = params.ID
            })
        else
            printToAll("Warning: Unable to set up Ommoran Hearthstone Mini, it's not in the expansion box", 'Red')
        end
    end

    -- Heartstone Gem
    params={
        bag = expansionBox,
        ID = GUIDs.hearstoneGem,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.hearthstoneGemLoc,
            rotation = locations.hearthstoneGemRot,
            guid = params.ID
        })
    else
        printToAll("Warning: Unable to set up Ommoran Hearthstone Gem, it's not in the expansion box", 'Red')
    end

    -- Mini hidden cave segment gem
    params={
        bag = expansionBox,
        ID = GUIDs.miniHiddenCaveBag,
    }
    if Global.call('isInBag',params) then
        params.bag.takeObject({
            position = locations.miniHiddenCavesBagLoc,
            rotation = locations.miniHiddenCavesBagRot,
            guid = params.ID,
            -- Lock tiles afer spawn
            callback="afterSpawnLock", callback_owner=Global
        })
    else
        printToAll("Warning: Unable to set up Mini hidden cave segments bag, it's not in the expansion box", 'Red')
    end

    -- Stickers
    for i = 1, 8 do
        params={
            bag = expansionBox,
            ID = GUIDs.stickers[i],
        }
        if Global.call('isInBag',params) then
            params.bag.takeObject({
                position = locations.stickerLocs[i],
                rotation = locations.stickerRot,
                guid = params.ID
            })
        else            
            printToAll(string.format("Warning: Unable to set up %s sticker, it's not in the expansion box", stickerNames[i]), 'Red')
        end
    end

    -- Place red cubes on the drilldozer token
    RedCubeBag_GUID = '38e127'
    RedCubeBag = getObjectFromGUID(RedCubeBag_GUID)
    for i=1, 5 do
        RedCubeBag.takeObject(
            {
                position = locations.redCubeLocs[i]
            }
        )
    end

    challengeCardsQuantity = 12
    beerCardsQuantity = 8
    oHeartCardsQuantity = 7
    challengeCardsCount = 0
    beerCardsCount = 0
    oHeartCardsCount = 0

    -- Iterate through everything else in the box, 
    -- This is for things that can't be referenced by GUIDs such as decks and PDFs
    index = #expansionBox.getObjects()
    for i = 1, index do
        obj = expansionBox.TakeObject()

        obj.lock()

        if obj.type == "Deck" then
            deckCount = #obj.getObjects()
            for _, containedObject in ipairs(obj.getObjects()) do
                if (containedObject.gm_notes == "challengeCard") then
                    obj.setLock(false)
                    obj.setRotation({0.0, 180.0, 180.0})
                    obj.setPosition({-46.00, 2.25, 3.84})
                    challengeCardsCount = deckCount + challengeCardsCount
                    break
                elseif (containedObject.gm_notes == "beerCard") then
                    obj.setLock(false)
                    obj.setRotation({0.0, 180.0, 180.0})
                    obj.setPosition({-38.03, 1.23, 3.50})
                    beerCardsCount = deckCount + beerCardsCount
                    break
                elseif (containedObject.gm_notes == "oHeartCard") then
                    obj.setLock(false)
                    obj.setRotation({0.0, 180.0, 180.0})
                    obj.setPosition(Global.call('getOHeartDeckZone').GetPosition())
                    oHeartCardsCount = deckCount + oHeartCardsCount
                    break
                end
            end
        elseif obj.getGMNotes() == "challengeCard" then
            obj.setLock(false)
            obj.setRotation({0.0, 180.0, 180.0})
            obj.setPosition({-46.00, 2.25, 3.84})
            challengeCardsCount = challengeCardsCount + 1
        elseif obj.getGMNotes() == "beerCard" then
            obj.setLock(false)
            obj.setRotation({0.0, 180.0, 180.0})
            obj.setPosition({-38.03, 1.23, 3.50})
            beerCardsCount = beerCardsCount + 1
        elseif obj.getGMNotes() == "oHeartCard" then
            obj.setLock(false)
            obj.setRotation({0.0, 180.0, 180.0})
            obj.setPosition(Global.call('getOHeartDeckZone').GetPosition())
            oHeartCardsCount = oHeartCardsCount + 1
        end
    end

    if (challengeCardsCount < challengeCardsQuantity) then
        printToAll("Warning: Unable to set up all challenge cards, they're not in the expansion box", 'Red')
    end

    if (beerCardsCount < beerCardsCount) then
        printToAll("Warning: Unable to set up beer cards, they're not in the expansion box", 'Red')
    end

    if (oHeartCardsCount < oHeartCardsQuantity) then
        printToAll("Warning: Unable to set up all Ommeran Heart cards, they're not in the expansion box", 'Red')
    end

    Global.call('SpaceRigXpacIDs')

    -- TODO:    
    -- Mission cards
end

function DisableExpansion()
    self.clearButtons()

    Wait.time(function()
        ShowEnableExpansionButton()
    end,2)

    -- Checking to see if player minis are on the board (in the middle of a mission)
    if (Global.Call('getMissionCleanupScript').Call('CheckForPlayersInCleanupZone')) then
        printToAll('Unable to clean up: Space Rig Expansion', 'Red')
        printToAll('\nMission in progress detected, cleanup mission before disabling expansion\n', 'Red')
        return
    end

    printToAll('Cleaning up: Space Rig Expansion', 'Yellow')

    Global.Call('setSpaceRigExpansionToggle',false)

    -- // Expansion Cleanup //
    local objects = getAllObjects()
    -- instead of long if else statements use dictionary or more sophisticated table.find

    for _, object in ipairs(objects) do
        objGUID = object.GetGUID()

        rulebookAidParams = {table = GUIDs.rulebookAids, value = objGUID}
        oxygenTokenParams = {table = GUIDs.oxygenTokens, value = objGUID}
        stickersParams = {table = GUIDs.stickers, value = objGUID}
        secondariesCardsParams = {table = GUIDs.cards.secondaries, value = objGUID}
        rockAndStoneCardsParams = {table = GUIDs.cards.rockAndStone, value = objGUID}

        if objGUID == GUIDs.rulebook then
            expansionBox.putObject(object)
        elseif Global.Call('TableContains', rulebookAidParams) then
            expansionBox.putObject(object)
        elseif Global.Call('TableContains', oxygenTokenParams) then
            expansionBox.putObject(object)
        elseif Global.Call('TableContains', secondariesCardsParams) then
            expansionBox.putObject(object)
        elseif Global.Call('TableContains', rockAndStoneCardsParams) then
            expansionBox.putObject(object)

        elseif objGUID == GUIDs.oxygenCubesBag then
            expansionBox.putObject(object)

        elseif objGUID == GUIDs.upgradeBoardGunner then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.upgradeBoardScout then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.upgradeBoardDriller then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.upgradeBoardEngineer then
            expansionBox.putObject(object)

        elseif objGUID == GUIDs.spaceRigBoard then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.memorialStatue then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.trackerCube1 then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.trackerCube2 then
            expansionBox.putObject(object)

        elseif Global.Call('TableContains', stickersParams) then
            expansionBox.putObject(object)

        elseif object.getGMNotes() == 'warning' then
            getObjectFromGUID(missionModRedBag).putObject(object)
        elseif object.getGMNotes() == 'anomalie' then
            getObjectFromGUID(missionModYellowBag).putObject(object)

        elseif object.getGMNotes() == 'upgradeH' then
            getObjectFromGUID(upgradesHUDBag).putObject(object)
        elseif object.getGMNotes() == 'upgradeA' then
            getObjectFromGUID(upgradesArmourBag).putObject(object)
        elseif object.getGMNotes() == 'upgradeP' then
            getObjectFromGUID(upgradesPickaxeBag).putObject(object)

        elseif object.getGMNotes() == 'abandonedGear' then
            getObjectFromGUID(pickupAbandonedGearBag).putObject(object)
        elseif object.getGMNotes() == 'gLootbug' then
            getObjectFromGUID(pickupGoldBugBag).putObject(object)
        elseif object.getGMNotes() == 'yeastCone' then
            getObjectFromGUID(pickupMaltSaltBag).putObject(object)
        elseif object.getGMNotes() == 'maltStar' then
            getObjectFromGUID(pickupYeastBag).putObject(object)

        elseif object.getGMNotes() == 'pJack' then
            getObjectFromGUID(pumpjackBag).putObject(object)
        elseif object.getGMNotes() == 'sPipe' then
            getObjectFromGUID(pipeStraightBag).putObject(object)
        elseif object.getGMNotes() == 'cPipe' then
            getObjectFromGUID(pipeCurvedBag).putObject(object)

        elseif objGUID == GUIDs.drilldozer then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.drilldozerToken then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.refinery then
            expansionBox.putObject(object)

        elseif objGUID == GUIDs.heartstoneClosed then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.hearstoneOpen then
            expansionBox.putObject(object)
        elseif objGUID == GUIDs.hearstoneGem then
            expansionBox.putObject(object)

        elseif object.getGMNotes() == 'beamer' then
            getObjectFromGUID(beamerBag).putObject(object)

        elseif object.getGMNotes() == 'miniHiddenCave' then
            getObjectFromGUID(miniHiddenCaveBag).putObject(object)

        elseif object.getGMNotes() == "oCube" then
            destroyObject(object)

        -- Searching decks for cards
        elseif object.type == "Deck" then
            deckPosition = object.getPosition()
            for _, containedObject in ipairs(object.getObjects()) do
                -- have to take the object out of the deck to be able to read
                -- it's info
                obj = object.takeObject({smooth = false})
                if (obj.getGUID() == GUIDs.cards.secondaries[1])
                or (obj.getGUID() == GUIDs.cards.secondaries[2])
                or (obj.getGUID() == GUIDs.cards.rockAndStone[1])
                or (obj.getGUID() == GUIDs.cards.rockAndStone[2])
                or (obj.getGMNotes() == "oHeartCard")
                or (obj.getGMNotes() == "beerCard")
                or (obj.getGMNotes() == "challengeCard")
                then
                    expansionBox.putObject(obj)
                else
                    -- if the object in the deck is not in part of the expansion
                    -- put it back where it was (note: this will shuffle the decks around)
                    obj.setPosition(deckPosition)
                end
            end
        end
    end

    -- Destroy red cubes on top of drilldozer token
    dozeCubeZone_GUID = 'c16b97'
    dozerCubeZone = getObjectFromGUID(dozeCubeZone_GUID)
    for _, containedObject in ipairs(dozerCubeZone.getObjects()) do
        if (containedObject.getGMNotes() == 'rCube') then
            destroyObject(containedObject)
        end
    end

    -- Wait a few seconds for objects to be placed into bags and then
    -- clean up the bags
    Wait.time(function()
        objects = getAllObjects()
        for _, object in ipairs(objects) do
            if (object.getGUID() == GUIDs.missionModRedBag)
            or (object.getGUID() == GUIDs.missionModYellowBag)
            or (object.getGUID() == GUIDs.upgradesHUDBag)
            or (object.getGUID() == GUIDs.upgradesArmourBag)
            or (object.getGUID() == GUIDs.upgradesPickaxeBag)
            or (object.getGUID() == GUIDs.pickupShuffleBag)
            or (object.getGUID() == GUIDs.pickupAbandonedGearBag)
            or (object.getGUID() == GUIDs.pickupGoldBugBag)
            or (object.getGUID() == GUIDs.pickupMaltSaltBag)
            or (object.getGUID() == GUIDs.pickupYeastBag)
            or (object.getGUID() == GUIDs.pumpjackBag)
            or (object.getGUID() == GUIDs.pipeStraightBag)
            or (object.getGUID() == GUIDs.pipeCurvedBag)
            or (object.getGUID() == GUIDs.beamerBag)
            or (object.getGUID() == GUIDs.miniHiddenCaveBag)
            then
                expansionBox.putObject(object)
            end
        end
    end, 2)
end